{
  "version": 3,
  "name": "API Gateway",
  "port": {{ .ports.api_gateway_port }},
  {{ if and .tls.public_key .tls.private_key }}
  "tls": {
    "public_key": "{{ .tls.public_key }}",
    "private_key": "{{ .tls.private_key }}"
  },
  {{ end }}
  "client_tls": {
    "allow_insecure_connections": true
  },
  "timeout": "3000ms",
  "cache_ttl": "300s",
  {{ include "plugin" }},
  "extra_config": {
    "router":{
        "logger_skip_paths":[
          "/__health"
        ]
    },
    "telemetry/logging": {
      "level": "{{ .observe.log_level }}",
      "prefix": "[KRAKEND]",
      "spans": true,
      "syslog": false,
      "stdout": true
    },
    {{ template "opencensus.tmpl" . }},
    {{ if eq .observe.influxdb_enabled "true" }}
      {{ template "influxdb_metrics.tmpl" . }},
    {{ end }}
    {{ template "cors.tmpl" . }},
  "plugin/http-server": {
      "name": ["grpc-proxy"],
      "grpc-proxy": {
        {{ if eq .project.name "base" }}
          "mgmt": "{{ .backends.mgmt }}"
        {{ end }}
        {{ if eq .project.name "vdp" }}
          "pipeline": "{{ .backends.pipeline }}",
          "connector": "{{ .backends.connector }}"
        {{ end }}
        {{ if eq .project.name "model" }}
          "model": "{{ .backends.model }}"
        {{ end }}
      }
    }
  },
  "endpoints": [
    {{ if eq .project.name "base" }}
      {{- template "mgmt.tmpl" . }},
    {{ end }}
    {{ if eq .project.name "vdp" }}
      {{- template "pipeline.tmpl" . }},
      {{- template "connector.tmpl" . }},
    {{ end }}
    {{ if eq .project.name "model" }}
      {{- template "model.tmpl" . }},
    {{ end }}
    {{- template "debug.tmpl" . }}
  ]
}
