{
  "version": 3,
  "name": "API Gateway",
  "port": {{ .ports.api_gateway_port }},
  {{ if and .tls.public_key .tls.private_key }}
  "tls": {
    "public_key": "{{ .tls.public_key }}",
    "private_key": "{{ .tls.private_key }}"
  },
  {{ end }}
  "client_tls": {
    "allow_insecure_connections": true
  },
  "timeout": "3000ms",
  "cache_ttl": "300s",
  {{ include "plugin" }},
  "extra_config": {
    "router":{
        "logger_skip_paths":[
          "/__health"
        ],
        "use_h2c": true
    },
    "telemetry/logging": {
      "level": "{{ .observe.log_level }}",
      "prefix": "[KRAKEND]",
      "spans": true,
      "syslog": false,
      "stdout": true
    },
    {{ template "opencensus.tmpl" . }},
    {{ template "influxdb_metrics.tmpl" . }},
    {{ template "cors.tmpl" . }},
    "plugin/http-server": {
      "name": ["multi-auth"],
      "multi-auth":{
        "token_validation_endpoint": "{{ .backends.mgmt }}/v1alpha/validate_token",
        "token_issuer_endpoint": "{{ .backends.mgmt }}/v1alpha/auth/token_issuer",
        "mgmt": "{{ .backends.mgmt }}"
      }
    }
  },
  "endpoints": [
    {{- template "mgmt.tmpl" . }},
    {{- template "pipeline.tmpl" . }},
    {{- template "connector.tmpl" . }},
    {{- template "model.tmpl" . }},
    {{- template "debug.tmpl" . }}
  ]
}
